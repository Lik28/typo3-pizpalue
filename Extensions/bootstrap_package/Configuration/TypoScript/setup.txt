#============#
# lib object #
#============#

# introduced with cookie consent
<INCLUDE_TYPOSCRIPT: source="FILE:EXT:pizpalue/Extensions/bootstrap_package/Configuration/TypoScript/Helper/Block.typoscript">

# allows to add curly braces to be treated of type getText in RTE editor
# @see https://docs.typo3.org/typo3cms/TyposcriptReference/DataTypes/Gettext/Index.html
lib.parseFunc_RTE.nonTypoTagStdWrap.insertData = 1


# [BUGFIX] Prepare colPos field for proper quoting (#452)
# Relates to https://forge.typo3.org/issues/81492
# and https://forge.typo3.org/issues/80506
# corrected by Anja:
# lib.dynamicContent.20.select.where = {#colPos}={register:colPos}
# reverted due to misfunction by Roman:
# lib.dynamicContent.20.select.where = colPos={register:colPos}


#=======#
# fonts #
#=======#

page {
    includeCSSLibs.googlewebfont = https://fonts.googleapis.com/css?family={$pizpalue.style.google-webfontfamily}
}

popup {
    includeCSSLibs.googlewebfont = https://fonts.googleapis.com/css?family={$pizpalue.style.google-webfontfamily}
}


#================#
# cookie consent #
#================#

page {
    jsFooterInline.10 >


    #------------------#
    # google analytics #
    #------------------#
    10.stdWrap.replacement {
        99 {
            search = ###GoogleAnalyticsStatus###
            replace {
                cObject < lib.block
                cObject.templateName = GoogleAnalyticsStatus
            }
        }
    }
    jsInline {
        99 = COA
        99 {
            if {
                isTrue = {$page.tracking.google.trackingID}
            }
            10 = TEXT
            10.value (
    var gaProperty = '{$page.tracking.google.trackingID}';
    var disableStr = 'ga-disable-' + gaProperty;
    if (document.cookie.indexOf(disableStr + '=true') > -1) {
        window[disableStr] = true;
    }
    function googleAnalyticsToggle(event) {
        if (document.cookie.indexOf(disableStr + '=true') > -1) {
            event.target.innerHTML = event.target.getAttribute('data-label-disable');
            googleAnalyticsOptIn();
        } else {
            event.target.innerHTML = event.target.getAttribute('data-label-enable');
            googleAnalyticsOptOut();
        }
    }
    function googleAnalyticsOptOut() {
        document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
        window[disableStr] = true;
    }
    function googleAnalyticsOptIn() {
        document.cookie = disableStr + '=; expires=Thu, 01 Jan 1970 00:00:01 UTC; path=/';
        window[disableStr] = false;
    }
    document.addEventListener('DOMContentLoaded', function() {
        var matches = document.querySelectorAll('[data-action="googleAnalyticsToggle"]');
        for (i=0; i<matches.length; i++) {
            if (document.cookie.indexOf(disableStr + '=true') > -1) {
                matches[i].innerHTML = matches[i].getAttribute('data-label-enable');
            } else {
                matches[i].innerHTML = matches[i].getAttribute('data-label-disable');
            }
            matches[i].onclick = function(event) {
                event.preventDefault();
                event.stopPropagation();
                googleAnalyticsToggle(event);
            }
        }
    });
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', '{$page.tracking.google.trackingID}', 'auto');
    ga('set', 'anonymizeIp', true);
            )
            90 = TEXT
            90.value (

    ga('send', 'pageview');
            )
        }
    }

    10 {
        dataProcessing {
            1 = Buepro\Pizpalue\DataProcessing\ConstantsProcessor
            1 {
                as = theme
                key = page.theme
            }
        }
    }
}

[globalVar = LIT:1 = {$page.theme.cookieconsent.enable}]
    page {
        includeCSS {
            PizpalueCookieConsentCss = EXT:pizpalue/Extensions/bootstrap_package/Resources/Public/Contrib/cookieconsent/cookieconsent.min.css
            PizpalueCookieConsentCss.disableCompression = 1
            PizpalueCookieConsentLess = EXT:pizpalue/Extensions/bootstrap_package/Resources/Public/Less/Cookieconsent.less
        }
        includeJSFooterlibs {
            contrib_cookieconsent = EXT:pizpalue/Extensions/bootstrap_package/Resources/Public/Contrib/cookieconsent/cookieconsent.min.js
            contrib_cookieconsent.disableCompression = 1
            bootstrap_cookieconsent = EXT:pizpalue/Extensions/bootstrap_package/Resources/Public/JavaScript/Src/jquery.cookieconsent.js
        }
    }
[end]